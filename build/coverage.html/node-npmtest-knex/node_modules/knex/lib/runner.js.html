<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for node-npmtest-knex/node_modules/knex/lib/runner.js</title>
    <meta charset="utf-8">
    <style>
        body, html {
            margin:0; padding: 0;
        }
        body {
            font-family: Arial, Helvetica;
            font-size: 10pt;
        }
        div.header, div.footer {
            background: #eee;
            padding: 1em;
        }
        div.header {
            height: 160px;
            padding: 0 1em 0 1em;
            z-index: 100;
            position: fixed;
            top: 0;
            border-bottom: 1px solid #666;
            width: 100%;
        }
        div.footer {
            border-top: 1px solid #666;
        }
        div.body {
            margin-top: 170px;
        }
        div.meta {
            font-size: 90%;
            text-align: center;
        }
        h1, h2, h3 {
            font-weight: normal;
        }
        h1 {
            font-size: 12pt;
        }
        h2 {
            font-size: 10pt;
        }
        pre {
            font-family: Menlo, Monaco, Consolas, Courier New, monospace;
            margin: 0;
            padding: 0;
            font-size: 14px;
            tab-size: 2;
        }

        div.path { font-size: 110%; }
        div.path a:link, div.path a:visited { color: #000; }
        table.coverage { border-collapse: collapse; margin:0; padding: 0 }

        table.coverage td {
            margin: 0;
            padding: 0;
            color: #111;
            vertical-align: top;
        }
        table.coverage td.line-count {
            width: 50px;
            text-align: right;
            padding-right: 5px;
        }
        table.coverage td.line-coverage {
            color: #777 !important;
            text-align: right;
            border-left: 1px solid #666;
            border-right: 1px solid #666;
        }

        table.coverage td.text {
        }

        table.coverage td span.cline-any {
            display: inline-block;
            padding: 0 5px;
            width: 40px;
        }
        table.coverage td span.cline-neutral {
            background: #eee;
        }
        table.coverage td span.cline-yes {
            background: #b5d592;
            color: #999;
        }
        table.coverage td span.cline-no {
            background: #fc8c84;
        }

        .cstat-yes { color: #111; }
        .cstat-no { background: #fc8c84; color: #111; }
        .fstat-no { background: #ffc520; color: #111 !important; }
        .cbranch-no { background:  yellow !important; color: #111; }

        .cstat-skip { background: #ddd; color: #111; }
        .fstat-skip { background: #ddd; color: #111 !important; }
        .cbranch-skip { background: #ddd !important; color: #111; }

        .missing-if-branch {
            display: inline-block;
            margin-right: 10px;
            position: relative;
            padding: 0 4px;
            background: black;
            color: yellow;
        }

        .skip-if-branch {
            display: none;
            margin-right: 10px;
            position: relative;
            padding: 0 4px;
            background: #ccc;
            color: white;
        }

        .missing-if-branch .typ, .skip-if-branch .typ {
            color: inherit !important;
        }

        .entity, .metric { font-weight: bold; }
        .metric { display: inline-block; border: 1px solid #333; padding: 0.3em; background: white; }
        .metric small { font-size: 80%; font-weight: normal; color: #666; }

        div.coverage-summary table { border-collapse: collapse; margin: 3em; font-size: 110%; }
        div.coverage-summary td, div.coverage-summary table  th { margin: 0; padding: 0.25em 1em; border-top: 1px solid #666; border-bottom: 1px solid #666; }
        div.coverage-summary th { text-align: left; border: 1px solid #666; background: #eee; font-weight: normal; }
        div.coverage-summary th.file { border-right: none !important; }
        div.coverage-summary th.pic { border-left: none !important; text-align: right; }
        div.coverage-summary th.pct { border-right: none !important; }
        div.coverage-summary th.abs { border-left: none !important; text-align: right; }
        div.coverage-summary td.pct { text-align: right; border-left: 1px solid #666; }
        div.coverage-summary td.abs { text-align: right; font-size: 90%; color: #444; border-right: 1px solid #666; }
        div.coverage-summary td.file { text-align: right; border-left: 1px solid #666; white-space: nowrap;  }
        div.coverage-summary td.pic { min-width: 120px !important;  }
        div.coverage-summary a:link { color: #000; }
        div.coverage-summary a:visited { color: #333; }
        div.coverage-summary tfoot td { border-top: 1px solid #666; }

        div.coverage-summary .yui3-datatable-sort-indicator, div.coverage-summary .dummy-sort-indicator {
            height: 10px;
            width: 7px;
            display: inline-block;
            margin-left: 0.5em;
        }
        div.coverage-summary .yui3-datatable-sort-indicator {
            background: no-repeat scroll 0 0 transparent;
        }
        div.coverage-summary .yui3-datatable-sorted .yui3-datatable-sort-indicator {
            background-position: 0 -20px;
        }
        div.coverage-summary .yui3-datatable-sorted-desc .yui3-datatable-sort-indicator {
            background-position: 0 -10px;
        }

        .high { background: #b5d592 !important; }
        .medium { background: #ffe87c !important; }
        .low { background: #fc8c84 !important; }

        span.cover-fill, span.cover-empty {
            display:inline-block;
            border:1px solid #444;
            background: white;
            height: 12px;
        }
        span.cover-fill {
            background: #ccc;
            border-right: 1px solid #444;
        }
        span.cover-empty {
            background: white;
            border-left: none;
        }
        span.cover-full {
            border-right: none !important;
        }
        pre.prettyprint {
            border: none !important;
            padding: 0 !important;
            margin: 0 !important;
        }
        .com { color: #999 !important; }
        .ignore-none { color: #999; font-weight: normal; }

    </style>
</head>
<body>
<div class="header low">
    <h1 style="font-weight: bold;">
        <a href="https://github.com/npmtest/node-npmtest-knex">npmtest-knex (v0.0.3)</a>
    </h1>
    <h1>Code coverage report for <span class="entity">node-npmtest-knex/node_modules/knex/lib/runner.js</span></h1>
    <h2>
        
        Statements: <span class="metric">19.81% <small>(21 / 106)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        
        Branches: <span class="metric">14.29% <small>(6 / 42)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        
        Functions: <span class="metric">8.33% <small>(2 / 24)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        
        Lines: <span class="metric">18.95% <small>(18 / 95)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        Ignored: <span class="metric"><span class="ignore-none">none</span></span> &nbsp;&nbsp;&nbsp;&nbsp;
    </h2>
    <div class="path"><a href="../../../../index.html">All files</a> &#187; <a href="index.html">node-npmtest-knex/node_modules/knex/lib/</a> &#187; runner.js</div>
</div>
<div class="body">
<pre><table class="coverage">
<tr><td class="line-count">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225</td><td class="line-coverage"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">'use strict';
&nbsp;
exports.__esModule = true;
&nbsp;
var _noop2 = require('lodash/noop');
&nbsp;
var _noop3 = _interopRequireDefault(_noop2);
&nbsp;
var _isArray2 = require('lodash/isArray');
&nbsp;
var _isArray3 = _interopRequireDefault(_isArray2);
&nbsp;
var _assign2 = require('lodash/assign');
&nbsp;
var _assign3 = _interopRequireDefault(_assign2);
&nbsp;
var _bluebird = require('bluebird');
&nbsp;
var _bluebird2 = _interopRequireDefault(_bluebird);
&nbsp;
var _helpers = require('./helpers');
&nbsp;
var helpers = _interopRequireWildcard(_helpers);
&nbsp;
function _interopRequireWildcard(obj) { <span class="missing-if-branch" title="else path not taken" >E</span>if (obj &amp;&amp; obj.__esModule) { return obj; } else { <span class="cstat-no" title="statement not covered" >var newObj = {}; <span class="cstat-no" title="statement not covered" ></span>if (obj != null) { <span class="cstat-no" title="statement not covered" >for (var key in obj) { <span class="cstat-no" title="statement not covered" >if (Object.prototype.hasOwnProperty.call(obj, key)) <span class="cstat-no" title="statement not covered" >newObj[key] = obj[key]; </span></span>} </span>} <span class="cstat-no" title="statement not covered" ></span>newObj.default = obj; <span class="cstat-no" title="statement not covered" ></span>return newObj; </span>} }
&nbsp;
function _interopRequireDefault(obj) { return obj &amp;&amp; obj.__esModule ? <span class="branch-0 cbranch-no" title="branch not covered" >obj </span>: { default: obj }; }
&nbsp;
var PassThrough = void 0;
&nbsp;
// The "Runner" constructor takes a "builder" (query, schema, or raw)
// and runs through each of the query statements, calling any additional
// "output" method provided alongside the query and bindings.
<span class="fstat-no" title="function not covered" >function Runner(client, builder) {</span>
<span class="cstat-no" title="statement not covered" >  this.client = client;</span>
<span class="cstat-no" title="statement not covered" >  this.builder = builder;</span>
<span class="cstat-no" title="statement not covered" >  this.queries = [];</span>
&nbsp;
  // The "connection" object is set on the runner when
  // "run" is called.
<span class="cstat-no" title="statement not covered" >  this.connection = void 0;</span>
}
&nbsp;
(0, _assign3.default)(Runner.prototype, {
&nbsp;
  // "Run" the target, calling "toSQL" on the builder, returning
  // an object or array of queries to run, each of which are run on
  // a single connection.
  run: <span class="fstat-no" title="function not covered" >function run() {</span>
<span class="cstat-no" title="statement not covered" >    var runner = this;</span>
<span class="cstat-no" title="statement not covered" >    return _bluebird2.default.using(this.ensureConnection(), <span class="fstat-no" title="function not covered" >function (connection) {</span></span>
<span class="cstat-no" title="statement not covered" >      runner.connection = connection;</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >      runner.client.emit('start', runner.builder);</span>
<span class="cstat-no" title="statement not covered" >      runner.builder.emit('start', runner.builder);</span>
<span class="cstat-no" title="statement not covered" >      var sql = runner.builder.toSQL();</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >      if (runner.builder._debug) {</span>
<span class="cstat-no" title="statement not covered" >        helpers.debugLog(sql);</span>
      }
&nbsp;
<span class="cstat-no" title="statement not covered" >      if ((0, _isArray3.default)(sql)) {</span>
<span class="cstat-no" title="statement not covered" >        return runner.queryArray(sql);</span>
      }
<span class="cstat-no" title="statement not covered" >      return runner.query(sql);</span>
    })
&nbsp;
    // If there are any "error" listeners, we fire an error event
    // and then re-throw the error to be eventually handled by
    // the promise chain. Useful if you're wrapping in a custom `Promise`.
    .catch(<span class="fstat-no" title="function not covered" >function (err) {</span>
<span class="cstat-no" title="statement not covered" >      if (runner.builder._events &amp;&amp; runner.builder._events.error) {</span>
<span class="cstat-no" title="statement not covered" >        runner.builder.emit('error', err);</span>
      }
<span class="cstat-no" title="statement not covered" >      throw err;</span>
    })
&nbsp;
    // Fire a single "end" event on the builder when
    // all queries have successfully completed.
    .tap(<span class="fstat-no" title="function not covered" >function () {</span>
<span class="cstat-no" title="statement not covered" >      runner.builder.emit('end');</span>
    });
  },
&nbsp;
&nbsp;
  // Stream the result set, by passing through to the dialect's streaming
  // capabilities. If the options are
  stream: <span class="fstat-no" title="function not covered" >function stream(options, handler) {</span>
&nbsp;
    // If we specify stream(handler).then(...
<span class="cstat-no" title="statement not covered" >    if (arguments.length === 1) {</span>
<span class="cstat-no" title="statement not covered" >      if (typeof options === 'function') {</span>
<span class="cstat-no" title="statement not covered" >        handler = options;</span>
<span class="cstat-no" title="statement not covered" >        options = {};</span>
      }
    }
&nbsp;
    // Determines whether we emit an error or throw here.
<span class="cstat-no" title="statement not covered" >    var hasHandler = typeof handler === 'function';</span>
&nbsp;
    // Lazy-load the "PassThrough" dependency.
<span class="cstat-no" title="statement not covered" >    PassThrough = PassThrough || require('readable-stream').PassThrough;</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >    var runner = this;</span>
<span class="cstat-no" title="statement not covered" >    var stream = new PassThrough({ objectMode: true });</span>
<span class="cstat-no" title="statement not covered" >    var promise = _bluebird2.default.using(this.ensureConnection(), <span class="fstat-no" title="function not covered" >function (connection) {</span></span>
<span class="cstat-no" title="statement not covered" >      runner.connection = connection;</span>
<span class="cstat-no" title="statement not covered" >      var sql = runner.builder.toSQL();</span>
<span class="cstat-no" title="statement not covered" >      var err = new Error('The stream may only be used with a single query statement.');</span>
<span class="cstat-no" title="statement not covered" >      if ((0, _isArray3.default)(sql)) {</span>
<span class="cstat-no" title="statement not covered" >        if (hasHandler) <span class="cstat-no" title="statement not covered" >throw err;</span></span>
<span class="cstat-no" title="statement not covered" >        stream.emit('error', err);</span>
      }
<span class="cstat-no" title="statement not covered" >      return runner.client.stream(runner.connection, sql, stream, options);</span>
    });
&nbsp;
    // If a function is passed to handle the stream, send the stream
    // there and return the promise, otherwise just return the stream
    // and the promise will take care of itsself.
<span class="cstat-no" title="statement not covered" >    if (hasHandler) {</span>
<span class="cstat-no" title="statement not covered" >      handler(stream);</span>
<span class="cstat-no" title="statement not covered" >      return promise;</span>
    }
&nbsp;
    // This promise is unreachable since no handler was given, so noop any
    // exceptions. Errors should be handled in the stream's 'error' event.
<span class="cstat-no" title="statement not covered" >    promise.catch(_noop3.default);</span>
<span class="cstat-no" title="statement not covered" >    return stream;</span>
  },
&nbsp;
&nbsp;
  // Allow you to pipe the stream to a writable stream.
  pipe: <span class="fstat-no" title="function not covered" >function pipe(writable, options) {</span>
<span class="cstat-no" title="statement not covered" >    return this.stream(options).pipe(writable);</span>
  },
&nbsp;
&nbsp;
  // "Runs" a query, returning a promise. All queries specified by the builder are guaranteed
  // to run in sequence, and on the same connection, especially helpful when schema building
  // and dealing with foreign key constraints, etc.
  query: _bluebird2.default.method(<span class="fstat-no" title="function not covered" >function (obj) {</span>
<span class="cstat-no" title="statement not covered" >    var _this = this;</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >    this.builder.emit('query', (0, _assign3.default)({ __knexUid: this.connection.__knexUid }, obj));</span>
<span class="cstat-no" title="statement not covered" >    var runner = this;</span>
<span class="cstat-no" title="statement not covered" >    var queryPromise = this.client.query(this.connection, obj);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >    if (obj.timeout) {</span>
<span class="cstat-no" title="statement not covered" >      queryPromise = queryPromise.timeout(obj.timeout);</span>
    }
&nbsp;
<span class="cstat-no" title="statement not covered" >    return queryPromise.then(<span class="fstat-no" title="function not covered" >function (resp) {</span></span>
<span class="cstat-no" title="statement not covered" >      var processedResponse = _this.client.processResponse(resp, runner);</span>
<span class="cstat-no" title="statement not covered" >      _this.builder.emit('query-response', processedResponse, (0, _assign3.default)({ __knexUid: _this.connection.__knexUid }, obj), _this.builder);</span>
<span class="cstat-no" title="statement not covered" >      _this.client.emit('query-response', processedResponse, (0, _assign3.default)({ __knexUid: _this.connection.__knexUid }, obj), _this.builder);</span>
<span class="cstat-no" title="statement not covered" >      return processedResponse;</span>
    }).catch(_bluebird2.default.TimeoutError, <span class="fstat-no" title="function not covered" >function (error) {</span>
<span class="cstat-no" title="statement not covered" >      var timeout = obj.timeout;</span>
<span class="cstat-no" title="statement not covered" >      var sql = obj.sql;</span>
<span class="cstat-no" title="statement not covered" >      var bindings = obj.bindings;</span>
&nbsp;
&nbsp;
<span class="cstat-no" title="statement not covered" >      var cancelQuery = void 0;</span>
<span class="cstat-no" title="statement not covered" >      if (obj.cancelOnTimeout) {</span>
<span class="cstat-no" title="statement not covered" >        cancelQuery = _this.client.cancelQuery(_this.connection);</span>
      } else {
<span class="cstat-no" title="statement not covered" >        cancelQuery = _bluebird2.default.resolve();</span>
      }
&nbsp;
<span class="cstat-no" title="statement not covered" >      return cancelQuery.catch(<span class="fstat-no" title="function not covered" >function (cancelError) {</span></span>
        // cancellation failed
<span class="cstat-no" title="statement not covered" >        throw (0, _assign3.default)(cancelError, {</span>
          message: 'After query timeout of ' + timeout + 'ms exceeded, cancelling of query failed.',
          sql: sql, bindings: bindings, timeout: timeout
        });
      }).then(<span class="fstat-no" title="function not covered" >function () {</span>
        // cancellation succeeded, rethrow timeout error
<span class="cstat-no" title="statement not covered" >        throw (0, _assign3.default)(error, {</span>
          message: 'Defined query timeout of ' + timeout + 'ms exceeded when running query.',
          sql: sql, bindings: bindings, timeout: timeout
        });
      });
    }).catch(<span class="fstat-no" title="function not covered" >function (error) {</span>
<span class="cstat-no" title="statement not covered" >      _this.builder.emit('query-error', error, (0, _assign3.default)({ __knexUid: _this.connection.__knexUid }, obj));</span>
<span class="cstat-no" title="statement not covered" >      throw error;</span>
    });
  }),
&nbsp;
  // In the case of the "schema builder" we call `queryArray`, which runs each
  // of the queries in sequence.
  queryArray: <span class="fstat-no" title="function not covered" >function queryArray(queries) {</span>
<span class="cstat-no" title="statement not covered" >    return queries.length === 1 ? this.query(queries[0]) : _bluebird2.default.bind(this).return(queries).reduce(<span class="fstat-no" title="function not covered" >function (memo, query) {</span></span>
<span class="cstat-no" title="statement not covered" >      return this.query(query).then(<span class="fstat-no" title="function not covered" >function (resp) {</span></span>
<span class="cstat-no" title="statement not covered" >        memo.push(resp);</span>
<span class="cstat-no" title="statement not covered" >        return memo;</span>
      });
    }, []);
  },
&nbsp;
&nbsp;
  // Check whether there's a transaction flag, and that it has a connection.
  ensureConnection: <span class="fstat-no" title="function not covered" >function ensureConnection() {</span>
<span class="cstat-no" title="statement not covered" >    var _this2 = this;</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >    return _bluebird2.default.try(<span class="fstat-no" title="function not covered" >function () {</span></span>
<span class="cstat-no" title="statement not covered" >      return _this2.connection || new _bluebird2.default(<span class="fstat-no" title="function not covered" >function (resolver, rejecter) {</span></span>
        // need to return promise or null from handler to prevent warning from bluebird
<span class="cstat-no" title="statement not covered" >        return _this2.client.acquireConnection().then(resolver).catch(_bluebird2.default.TimeoutError, <span class="fstat-no" title="function not covered" >function (error) {</span></span>
<span class="cstat-no" title="statement not covered" >          if (_this2.builder) {</span>
<span class="cstat-no" title="statement not covered" >            error.sql = _this2.builder.sql;</span>
<span class="cstat-no" title="statement not covered" >            error.bindings = _this2.builder.bindings;</span>
          }
<span class="cstat-no" title="statement not covered" >          throw error;</span>
        }).catch(rejecter);
      });
    }).disposer(<span class="fstat-no" title="function not covered" >function () {</span>
      // need to return promise or null from handler to prevent warning from bluebird
<span class="cstat-no" title="statement not covered" >      return _this2.client.releaseConnection(_this2.connection);</span>
    });
  }
});
&nbsp;
exports.default = Runner;
module.exports = exports['default'];
&nbsp;</pre></td></tr>
</table></pre>
</div>
<div class="footer">
    <div class="meta">Generated by <a href="https://github.com/kaizhu256/node-utility2" target="_blank">utility2</a> at Tue Apr 18 2017 19:54:23 GMT+0000 (UTC)</div>
</div>
</body>
</html>
